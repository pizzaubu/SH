{% extends "base.html" %}

{% block content %}
    <h1>Available Coupons</h1>
    <div id="coupon-list">
        {% if coupons %}
            <ul>
            {% for coupon in coupons %}
                <li>
                    <strong>{{ coupon.code }}</strong> - {{ coupon.discount }}% Discount
                    <button onclick="applyCoupon('{{ coupon.code }}')">Apply</button>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p>ไม่มีคูปองที่สามารถใช้งานได้</p>
        {% endif %}
    </div>

    <div id="apply-coupon">
        <h2>Apply a Coupon</h2>
        <input type="text" id="coupon_code" placeholder="Enter coupon code">
        <button onclick="applyCoupon()">Apply</button>
        <p id="coupon-message"></p>
    </div>

    <script>
        function applyCoupon(code) {
            if (!code) {
                code = document.getElementById("coupon_code").value;
            }
            if (!code) {
                return;
            }
            
            const xhr = new XMLHttpRequest();
            xhr.open("GET", "/apply-coupon?code=" + encodeURIComponent(code));
            xhr.onload = function() {
                const response = JSON.parse(xhr.responseText);
    
                if (response.success) {
                    document.getElementById("coupon-message").innerText = "Coupon applied! Discount: " + response.discount + "%";
                } else {
                    document.getElementById("coupon-message").innerText = response.message;
                }
            };
            xhr.send();
        }
    </script>
{% endblock %}    
